{% extends 'app/base.html' %}

{% load bootstrap4 %}
{% load humanize %}
{% load location %}

{% block title %}Your Account{% endblock title %}
{% block header %}Your Account{% endblock header %}

{% block content %}

  <section class='mt-2 mt-5'>
    <div class='card'>
      <div class='card-header'>
        <h4>Account Details</h4>
      </div>
      <div class='card-body'>
        <p>
          <form method='post' action='{% url "account" %}' class=' form-horizontal' role='form'>
            {{formset.management_form}}
            {% csrf_token %}
            {% bootstrap_formset_errors formset %}
            {% bootstrap_form_errors form %}
            <div class='form-group'>
              <input disabled='true' type="text" name="name" value="{{user.name}}" class="form-control" id="id_name">
            </div>
            <div class='form-group'>
              <input disabled='true' type="text" name="email" value="{{user.email}}" class="form-control" id="id_email">
            </div>
            <div class="form-group">
              {% bootstrap_field form.message show_help=False show_label=False%}
            </div>
            <div class='row'>
              <div class="form-group form-check-inline">
                {% bootstrap_field form.is_public show_help=False show_label=False size='large'%}
              </div>
              <div class="form-group form-check-inline">
                {% bootstrap_field form.is_subscribe show_help=False show_label=False size='large'%}
              </div>
            </div>
            <div class='row'>
              <div class="form-group form-check-inline">
                {% bootstrap_field form.is_volunteer show_help=False show_label=False size='large'%}
              </div>
              <div class="form-group form-check-inline">
                {% bootstrap_field form.is_teacher show_help=False show_label=False size='large'%}
              </div>
              <div class="form-group form-check-inline">
                {% bootstrap_field form.is_doctor show_help=False show_label=False size='large'%}
              </div>
            </div>
            <div class='card-title'>
              <h6>
                Student Schools and Grades
              </h6>
            </div>
            <input type="button" value="Add Another Student" id="add_more" class='btn btn-sm btn-success my-3'>

            <div>
              <table class='table table-sm'>
                <thead>
                  <tr>
                    <th>
                      School
                    </th>
                    <th>
                      Grade
                    </th>
                    <th>
                      Remove?
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <div id="form_set">
                    {% for form in formset %}
                      <tr>
                        <td>{% bootstrap_field form.organization show_help=False show_label=False size='small' placeholder='Search Schools....'%}</td>
                        <td>{% bootstrap_field form.grade show_help=False show_label=False size='small'%}</td>
                        <td>{{form.DELETE}}</td>
                      </tr>
                      {{form.id}}
                    {% endfor %}
                  </div>
                </tbody>
              </table>
              <div id="empty_form" style="display:none">
                  <table class='no_error table table-sm'>
                      <tr>
                      <td>{% bootstrap_field formset.empty_form.organization show_help=False show_label=False size='small' placeholder='Search Schools....'%}</td>
                      <td>{% bootstrap_field formset.empty_form.grade show_help=False show_label=False size='small'%}</td>
                      <td>{{formset.empty_form.DELETE}}</td>
                      {{formset.empty_form.id}}
                      </tr>
                  </table>
              </div>
            </div>
            {% buttons %}
              <button type="submit" class="btn btn-primary btn-lg btn-block">
                Save Account Details
              </button>
            {% endbuttons %}
          </form>
        </p>
      </div>
      <div class='card-footer'>
        <p class="card-text">
          <small class='text-muted'>
            If you would like to change your name or email please contact Dave at <a href='mailto:dbinetti@startnormal.com'>dbinetti@startnormal.com</a>.
          </small>
        </p>
      </div>
    </div>
  </section>
  <section class='mt-2 ml-2'>
    <a href='{% url "delete" %}'><span class='text-danger'>Delete Account</span></a>
  </section>
{% endblock content %}
{% block scripts %}
  {{formset.media}}
  <script>
    $('#add_more').click(function() {
      var form_idx = $('#id_students-TOTAL_FORMS').val();
      console.log(form_idx);
      $('#form_set').prepend($('#empty_form').html().replace(/__prefix__/g, form_idx));
      $('#id_students-TOTAL_FORMS').val(parseInt(form_idx) + 1);
    });
  </script>
{% endblock scripts %}
