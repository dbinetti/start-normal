{% extends 'app/base.html' %}

{% block title %}Get Involved{% endblock title %}
{% block header %}Get Involved{% endblock header %}

{% block content %}

  <section>
    <p class='lead'>
      Search Below for your School to see how you can get involved.
    </p>
  </section>

  <section>
    <div id="searchbox" class='my-5'>
    </div>
    {# <div id="refine" class='my-5'> #}
    {# </div> #}
    <div id="hits" class='my-5'>
    </div>
  </section>


  {% comment %}
  <section class='my-5'>
    <h4>
      Click on a District Name for Further Detail
    </h4>
    <table class='table table-small table-hover'>
      <thead>
        <tr>
          <th>
            Name
          </th>
          <th>
            Schedule
          </th>
          <th>
            Masks
          </th>
          <th>
            Next Meeting
          </th>
        </tr>
      </thead>
      <tbody>
        {% for district in districts %}
          <tr>
            <td>
              <a href='{% url "district" district.slug %}'>{{district.name}}</a>
            </td>
            <td>
              {{district.get_schedule_display}}
            </td>
            <td>
              {{district.get_masks_display}}
            </td>
            <td>
              {{district.meeting_date|date:"SHORT_DATE_FORMAT"}}
            </td>
          </tr>
        {% endfor %}
      </tbody>
      <tfoot>
        <tr>
          <td colspan=4>
            If you would like to update the status for your district, please send information to <a href=
            'mailto:dbinetti@startnormal.com'>dbinetti@startnormal.com</a>.  We will also be happy to add private schools to this list &mdash; please just send us the information.
          </td>
        </tr>
      </tfoot>
    </table>
  </section>
{% endcomment %}

{% endblock content %}

{% block scripts %}
  <script>

    const searchClient = algoliasearch(
      "{{app_id}}",
      "{{search_key}}",
    );

    let search = instantsearch({
      indexName: "{{index}}",
      searchClient,
    });

    search.addWidgets([
      instantsearch.widgets.searchBox({
        container: '#searchbox',
        placeholder: 'Search Schools...',
        autofocus: true,
        showReset: false,
        showSubmit: false,
        cssClasses: {
          root: 'root',
          form: 'form',
          input: 'input form-control form-control-large',
        },
      }),
    ]);

    search.addWidgets([
      instantsearch.widgets.infiniteHits({
        container: '#hits',
        templates: {
          item(item) {
            return `
              <strong><a href='district/${item.slug}'>${item.name}</a></strong><br>
              ${item.address}  ${item.city}, ${item.state}
            `;
          }
        },
        cssClasses: {
          list: 'list',
          item: 'my-3',
          loadPrevious: 'btn btn-primary mt-5',
          loadMore: 'btn btn-primary mt-5',
          disabledLoadPrevious: 'btn btn-primary mt-5',
          disabledLoadMore: 'btn btn-primary mt-5',
        },
      }),
    ]);

    // search.addWidgets([
    //   instantsearch.widgets.refinementList({
    //     container: '#refine',
    //     attribute: 'get_doc_display',
    //     // Optional parameters
    //     operator: string,
    //     limit: number,
    //     showMore: boolean,
    //     showMoreLimit: number,
    //     searchable: boolean,
    //     searchablePlaceholder: string,
    //     searchableIsAlwaysActive: boolean,
    //     searchableEscapeFacetValues: boolean,
    //     sortBy: string[]|function,
    //     templates: object,
    //     cssClasses: object,
    //     transformItems: function,
    //   })
    // ]);

    search.start();

  </script>
{% endblock scripts %}
