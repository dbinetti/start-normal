{% extends 'app/base.html' %}

{% load bootstrap4 %}
{% load humanize %}

{% block title %}Your Account{% endblock title %}
{% block header %}Your Account{% endblock header %}

{% block content %}

  <section class='mt-2 mt-5'>
    <div class='card'>
      <div class='card-header'>
        <h4>Account Details</h4>
      </div>
      <div class='card-body'>
        <p>
          <h5>
            Personal Information
          </h5>

          <form method='post' action='{% url "account" %}' class=' form-horizontal' role='form'>
            {{formset.management_form}}
            {% csrf_token %}
            {% bootstrap_formset_errors formset %}
            {% bootstrap_form_errors form %}
            <div class='form-group'>
              <input disabled='true' type="text" name="name" value="{{user.name}}" class="form-control" id="id_name">
            </div>
            <div class='form-group'>
              <input disabled='true' type="text" name="email" value="{{user.email}}" class="form-control" id="id_email">
            </div>
            <div class='my-5'>
              <h5>
                Parent Information
              </h5>
              {% if form %}
                <div class='table-responsive-lg mb-5'>
                  <table class='table table-sm'>
                    <thead>
                      <tr>
                        <th>
                          School
                        </th>
                        <th>
                          Grade
                        </th>
                        <th>
                          Remove?
                        </th>
                      </tr>
                    </thead>
                    <tbody>
                      <div id="form_set">
                        {% for form in formset %}
                          <tr>
                            <td>{% bootstrap_field form.school show_help=False show_label=False size='small' placeholder='Search California Schools....'%}</td>
                            <td>{% bootstrap_field form.grade show_help=False show_label=False size='small'%}</td>
                            <td>{{form.DELETE}}</td>
                          </tr>
                          {{form.id}}
                        {% endfor %}
                      </div>
                    </tbody>
                    <tfoot>
                      <tr>
                        <td colspan=3>
                          <span role='button' id="add_more" class='badge badge-success'>Add Another Student</span>&nbsp;<small class='text-muted'>Don't forget to click "Save" below!</small>
                        </td>
                      </tr>
                    </tfoot>
                  </table>
                  <div id="empty_form" style="display:none">
                    <table class='no_error table table-sm'>
                      <tr>
                        <td>{% bootstrap_field formset.empty_form.school show_help=False show_label=False size='small' placeholder='Search California Schools....'%}</td>
                        <td>{% bootstrap_field formset.empty_form.grade show_help=False show_label=False size='small'%}</td>
                        {{formset.empty_form.id}}
                      </tr>
                    </table>
                  </div>
                </div>
              {% else %}
                <div class='my-5'>
                  <a href='{% url "create-parent" %}' class='btn btn-outline-success'>Add Me as Parent</a>
                </div>
              {% endif %}
            </div>

            <div class='my-5'>
              <h5>
                Teacher Information
              </h5>
              {% if teacher_form %}
                {% bootstrap_form_errors teacher_form %}
                <strong>Location</strong>
                {% bootstrap_field teacher_form.school show_help=True show_label=False size='large' placeholder='Type to search....' %}
                {% bootstrap_field teacher_form.is_credential show_label=True show_help=True %}
                <strong>School Level</strong>
                {% bootstrap_field teacher_form.kinds show_label=False show_help=True %}
                <strong>School Subjects</strong>
                {% bootstrap_field teacher_form.subjects show_label=False show_help=True %}
                {% bootstrap_field teacher_form.notes show_label=True show_help=True placeholder='Notes (kept private)'  %}
              {% else %}
                <div>
                  <a href='{% url "create-teacher" %}' class='btn btn-outline-success'>Add Me as Teacher</a>
                </div>
              {% endif %}
            </div>
            {% buttons %}
              <button type="submit" class="btn btn-primary btn-lg btn-block">
                Save Account Details
              </button>
            {% endbuttons %}
          </form>
        </p>
      </div>
      <div class='card-footer'>
        <p class="card-text">
          <small class='text-muted'>
            If you would like to change your name or email please contact Dave at <a href='mailto:dbinetti@startnormal.com'>dbinetti@startnormal.com</a>.
          </small>
        </p>
      </div>
    </div>
  </section>
  <section class='mt-2 ml-2'>
    <a href='{% url "delete" %}'><span class='text-danger'>Delete Account</span></a>
  </section>
{% endblock content %}
{% block scripts %}
  {{formset.media}}
  <script>
    $('#add_more').click(function() {
      var form_idx = $('#id_students-TOTAL_FORMS').val();
      $('#form_set').prepend($('#empty_form').html().replace(/__prefix__/g, form_idx));
      $('#id_students-TOTAL_FORMS').val(parseInt(form_idx) + 1);
    });
  </script>
{% endblock scripts %}
