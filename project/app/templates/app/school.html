{% extends 'app/base.html' %}

{% load bootstrap4 %}
{% load humanize %}

{% block title %}{{school.name}}{% endblock title %}
{% block header %}{{school.name}}{% endblock header %}
{% block subheader %}
  {{school.address}}, {{school.city}}, {{school.state}}&nbsp;&nbsp;<a href='tel:{{school.phone}}'>{{school.phone}}</a>&nbsp;<a href='{{school.website}}'>{{school.website}}</a><br>
  {{school.district.name}}
{% endblock subheader %}

{% block content %}

  {% if not request.user.is_authenticated %}
  <section class='mt-3'>
    <div class='row'>
      <div class='col-lg-6 my-2'>
        <a href='{% url "signup" "parent" %}' role='button' class="btn btn-success btn-block btn-lg">
          Parent Signup
        </a>
      </div>
      <div class='col-lg-6 my-2'>
        <a href='{% url "signup" "teacher" %}' role='button' class="btn btn-primary btn-block btn-lg">
          Teacher Signup
        </a>
      </div>
    </div>
  </section>
{% endif %}
  {% if request.user.is_authenticated %}
    <section class='my-5'>
      <div class='card'>
        <div class='card-header'>
          <h4>Potential Classmates</h4>
        </div>
        <div class='card-body'>
          <table class='table'>
            <thead>
              <th>
                Grade
              </th>
              <th>
                Student Name
              </th>
              <th>
                Parent Name
              </th>
              <th>
                Parent Email
              </th>
            </thead>
            <tbody>
              {% for student in students %}
                <tr>
                  <td>
                    {{student.get_grade_display}}
                  </td>
                  {% if user.is_authenticated %}
                    <td>
                      {{student.name}}
                    </td>
                    <td>
                      {{student.parent.user.name}}
                    </td>
                    <td>
                      {{student.parent.user.email}}
                    </td>

                  {% else %}
                    <td>
                      {{student.name.0|upper}}.{{student.parent.user.name.0|upper}}.
                    </td>
                    <td colspan=2>
                      <em>
                        Register to see student and parent information.
                      </em>
                    </td>
                  {% endif %}
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        <div class='card-footer'>
          <p>
            I am hard at work to create a tool to help you form Homerooms.  In the meantime, to add any of these students to your Homeroom please email me at <a href='mailto:dbinetti@startnormal.com'>dbinetti@startnormal.com</a> or call/text 415.713.2126
          </p>
        </div>
      </div>
    </section>
  {% else %}
    <section class='my-5'>
      <div class='card'>
        <div class='card-header'>
          <h4>Potential Classmates</h4>
        </div>
        <div class='card-body'>
          <table class='table'>
            <thead>
              <th>
                Grade
              </th>
              <th>
                Student Name
              </th>
              <th>
                Parent Name
              </th>
              <th>
                Parent Email
              </th>
            </thead>
            <tbody>
              {% for student in students %}
                <tr>
                  <td>
                    {{student.get_grade_display}}
                  </td>
                  {% if user.is_authenticated %}
                    <td>
                      {{student.name}}
                    </td>
                    <td>
                      {{student.parent.user.name}}
                    </td>
                    <td>
                      {{student.parent.user.email}}
                    </td>
                  {% else %}
                    <td>
                      {{student.name.0|upper}}.{{student.parent.user.name.0|upper}}.
                    </td>
                    <td colspan=2>
                      <em>
                        Register to see student and parent information.
                      </em>
                    </td>
                  {% endif %}
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </section>
  {% endif %}


  {% comment %}
  <section class='my-5'>
    <div class='card'>
      <div class='card-header'>
        <h4>Homerooms</h4>
      </div>
      <div class='card-body'>
        <table class='table'>
          <thead>
            <th>
              Homeroom
            </th>
            <th>
              Students
            </th>
          </thead>
          <tbody>
            {% for homeroom in homerooms %}
              <tr>
                <td>
                  <a href='{% url "homeroom" homeroom.id %}'>{{homeroom.name}}</a>
                </td>
                <td>
                  {{homeroom.students.count}}
                </td>
                <td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </section>
  {% endcomment %}
  <section class='my-5'>
    <div class='card'>
      <div class='card-header'>
        <h4>Reports</h4>
      </div>
      <div class='card-body'>
        {% for user_report in user_reports %}
            <p>
              <strong>{{user_report.title}}</strong>&nbsp;&nbsp;<small class='text-muted'>Reported by {{user_report.user.name}} on {{user_report.created|date}} <em>(PENDING)</em></small><br>
              {{user_report.text}}
            </p>
        {% endfor %}
        {% for report in reports %}
          {% if reports.count == 1 %}
            <p>
              <strong>{{report.title}}</strong>&nbsp;&nbsp;<small class='text-muted'>Reported by {{report.user.name}} on {{report.created|date}}</small><br>
              {{report.text}}
            </p>
          {% else %}
            {% if forloop.first %}
              <p>
                <strong>{{report.title}}</strong>&nbsp;&nbsp;<small class='text-muted'>Reported by {{report.user.name}} on {{report.created|date}}</small><br>
                {{report.text}}
              </p>
              <span class="badge badge-warning" data-toggle="collapse" data-toggle="collapse" data-target="#moreReports" role='button'>Show All</span>
            {% else %}
              <div class='collapse' id='moreReports'>
                <p>
                  <strong>{{report.title}}</strong>&nbsp;&nbsp;<small class='text-muted'>Reported by {{report.user.name}} on {{report.created|date}}</small><br>
                  {{report.text}}
                </p>
              </div>
            {% endif %}
          {% endif %}
        {% empty %}
          <p>
            No Current Reports.
          </p>
        {% endfor %}
      </div>
      <div class='card-footer'>
        {% if request.user.is_authenticated %}
          <a href='{% url "add-report" school.slug %}' role='button' class='btn btn-success'>Submit a Report</a>
        {% else %}
          {# <a href='{% url "involved" %}' role='button' class='btn btn-success'>Get Involved!</a> #}
        {%endif%}
      </div>
    </div>
  </section>

  <section class='my-5'>
    <div class='card'>
      <div class='card-header'>
        <h4>Contacts</h4>
      </div>
      <div class='card-body'>
        <table class='table'>
          <thead>
            <th>
              Name
            </th>
            <th>
              Role
            </th>
            <th>
              Email
            </th>
            <th>
              Phone
            </th>
          </thead>
          <tbody>
            {% for contact in contacts %}
              <tr>
                <td>
                  {{contact.name}}
                </td>
                <td>
                  {{contact.get_role_display}}
                </td>
                <td>
                  <a href='mailto:{{contact.email}}'>{{contact.email}}</a>
                </td>
                <td>
                  <a href='tel:{{contact.phone}}'>{{contact.phone}}</a>
                </td>
              </tr>
            {% empty %}
              <tr>
                <td colspan=4>
                  (No Contacts)
                </td>
              </tr>
            {% endfor %}
          </tbody>
          <tfoot class='mt-2'>
            <tr>
              <td colspan=4>
                <small class='text-muted'>Information Out-of-Date?  Please email me at <a href='mailto:dbinetti@startnormal.com'>dbinetti@startnormal.com</a>.</small>
              </td>
            </tr>
          </tfoot>
        </table>
      </div>
      <div class='card-footer'>
        {% if request.user.is_authenticated %}
          <a href='{% url "add-contact" school.slug %}' role='button' class='btn btn-success'>Add a Contact</a>
        {% else %}
          {# <a href='{% url "involved" %}' role='button' class='btn btn-success'>Get Involved!</a> #}
        {%endif%}
      </div>
    </div>
  </section>

{% endblock content %}
